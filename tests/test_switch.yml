---
- name: simple switch with four L3 interfaces and remaining L2 ports
  hosts: switches@travis
  gather_facts: yes
  vars:
    ansible_user: admin
    ops_debug: yes
    cli:
      username: "{{ ops_username }}"
      password: "{{ ops_password }}"
      host: "{{ ansible_host }}"
      port: "{{ ansible_port }}"

  roles:
    - role: switch
      ops_system_hostname: switch
      ops_intf_admin_state: up
      ops_vrfs:
        - name: vrf_default
          ports: [1, 2, 3]
      ops_bridges:
        - name: bridge_normal
          ports: [             4,  5,  6,  7,  8,  9, 10,
                  11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
                  21, 22, 23, 24, 25, 26, 27, 28, 29, 30,
                  31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
                  41, 42, 43, 44]
      ops_ports:
        - name: 1
          ipv4_address: 172.16.0.1/24
        - name: 2
          ipv4_address: 172.16.1.1/24
        - name: 3
          ipv4_address: 172.16.2.1/24
        - name: 4
        - name: 5
        - name: 6
        - name: 7
        - name: 8
        - name: 9
        - name: 10
        - name: 11
        - name: 12
        - name: 13
        - name: 14
        - name: 15
        - name: 16
        - name: 17
        - name: 18
        - name: 19
        - name: 20
        - name: 21
        - name: 22
        - name: 23
        - name: 24
        - name: 25
        - name: 26
        - name: 27
        - name: 28
        - name: 29
        - name: 30
        - name: 31
        - name: 32
        - name: 33
        - name: 34
        - name: 35
        - name: 36
        - name: 37
        - name: 38
        - name: 39
        - name: 40
        - name: 41
        - name: 42
        - name: 43
        - name: 44
        - name: 45
        - name: 46
        - name: 47
        - name: 48

  post_tasks:
    - name: Check if ports are correctly L3 ports
      ops_command:
        commands:
          - show hostname
          - show interface 1 brief
          - show interface 2 brief
          - show interface 3 brief
          - show interface 4 brief
        provider: "{{ cli }}"
        waitfor:
          - "result[0] contains 'switch'"
          - "result[1] contains 'routed'"
          - "result[2] contains 'routed'"
          - "result[3] contains 'routed'"
          - "result[4] contains 'access'"
        interval: 1
        retries: 2
      register: result
      connection: local
    - name: debug the result
      debug: var=result
      when: ops_debug
